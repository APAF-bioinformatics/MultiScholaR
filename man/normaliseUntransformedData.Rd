% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/metabolite_normalization.R
\name{normaliseUntransformedData,MetaboliteAssayData,character-method}
\alias{normaliseUntransformedData,MetaboliteAssayData,character-method}
\title{Normalize by Internal Standard (ITSD) for MetaboliteAssayData}
\usage{
\S4method{normaliseUntransformedData}{MetaboliteAssayData,character}(
  theObject,
  method = "ITSD",
  itsd_pattern_columns = NULL,
  itsd_aggregation = "sum",
  remove_itsd_after_norm = TRUE,
  ...
)
}
\arguments{
\item{theObject}{A \code{MetaboliteAssayData} object.}

\item{method}{Must be "ITSD" for this method.}

\item{itsd_pattern_columns}{A character vector specifying the column names within
each assay tibble where the ITSD pattern should be searched. If \code{NULL} (default),
it uses the column name stored in the \code{annotation_id_column} slot of the object.}

\item{itsd_aggregation}{The method used to aggregate intensities of multiple ITSDs
within each sample. Options are "sum" (default),
"mean", or "median".}

\item{remove_itsd_after_norm}{Logical (default: TRUE). If TRUE, rows identified as
ITSDs are removed from the assay tibbles after normalization is complete.}

\item{...}{Currently unused.}
}
\value{
An updated \code{MetaboliteAssayData} object with ITSD-normalized values in the
\code{metabolite_data} slot. Normalization status is recorded in the \code{args} slot.
}
\description{
Normalizes the untransformed metabolite intensity data in each assay of a
\code{MetaboliteAssayData} object using Internal Standards (ITSDs).
}
\details{
This method corrects for systematic variations between samples (e.g., differences
in sample loading or instrument sensitivity) based on the signal of Internal
Standards (ITSDs). The process involves:
\enumerate{
\item Identifying ITSD features using a regex pattern (\code{internal_standard_regex} slot)
applied to specified annotation columns (\code{itsd_pattern_columns}).
\item Calculating an aggregate ITSD signal for \emph{each sample} by combining the
intensities of all identified ITSDs within that sample. The aggregation method
is chosen via \code{itsd_aggregation} ("sum", "mean", or "median").
\item Calculating the \emph{average} of these aggregate ITSD signals across \emph{all samples}.
\item For each sample, calculating a normalization factor:
\code{Factor = Average_Aggregate_ITSD / Sample_Aggregate_ITSD}.
\item Multiplying the intensity of every non-ITSD feature in that sample by this
sample-specific \code{Factor}.
}

This method operates on the raw (or previously normalized, but typically not
log-transformed) data in the \code{metabolite_data} slot. It aims to preserve the
overall scale of the data while adjusting relative differences between samples,
centering the normalized data around the average ITSD response observed.

Assays where no ITSDs are found will issue a warning and remain unchanged. Samples
where the aggregate ITSD signal is zero or NA will also result in warnings,
and the normalized values for those samples will likely become NA.
}
\section{Functions}{
\itemize{
\item \code{normaliseUntransformedData(theObject = MetaboliteAssayData, method = character)}: Method for MetaboliteAssayData using ITSD

}}
