---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
#Test if BioManager is installed
if (!requireNamespace("BiocManager", quietly = TRUE)) {
  install.packages("BiocManager")
  BiocManager::install()
}

# load pacman package manager
if (!require(pacman)) {
  install.packages("pacman")
  library(pacman)
}

p_load(Glimma)
p_load(tidyverse)
p_load(ProteomeRiver)
```

```{r}

eb.fit <- readRDS( "/home/ignatius/PostDoc/2021/Podocyte_2021/Results/Part_1/de_analysis/fit.eb.RDS")

prot_annot_tbl <- vroom::vroom("/home/ignatius/PostDoc/2021/Podocyte_2021/Results/Part_1/annot_proteins/de_proteins_long_annot.tsv")
prot_output_dir <- "/home/ignatius/PostDoc/2021/Podocyte_2021/Results/Part_1/proteomics_plots"


```

```{r}

prot_annot_tbl_cln <- prot_annot_tbl %>%
  dplyr::select( uniprot_acc, UNIPROT_GENENAME, `PROTEIN-NAMES`) %>%
  dplyr::mutate( gene_name = purrr::map_chr(UNIPROT_GENENAME, ~str_split(., ":") %>% purrr::map_chr(1) )) %>%
  dplyr::mutate( prot_name = purrr::map_chr(`PROTEIN-NAMES`, ~str_split(., ":") %>% purrr::map_chr(1) )) %>%
  dplyr::select(-UNIPROT_GENENAME, -`PROTEIN-NAMES`) %>%
  distinct()
  
```

```{r}
#eb.fit$coefficients
purrr::walk( colnames(eb.fit$coefficients), 
             ~plotProteinsGlimmaMA(eb.fit, ., prot_annot_tbl_cln, uniprot_acc,
                                     output_dir=prot_output_dir, "qvalue") )

```


```{r}
purrr::walk( colnames(eb.fit$coefficients), 
             ~plotProteinsGlimmaVolcano(eb.fit, ., prot_annot_tbl_cln, uniprot_acc,
                                     output_dir=prot_output_dir, "qvalue") )
```








